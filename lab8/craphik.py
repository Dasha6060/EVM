import matplotlib.pyplot as plt
import numpy as np

data = """Elements,Size_KB,Size_MB,Forward,Backward,Random
16,0,0.00,8.75,8.75,8.75
48,0,0.00,5.00,5.00,5.00
80,0,0.00,5.00,5.00,5.00
112,0,0.00,5.00,5.00,5.00
144,0,0.00,5.00,5.00,5.00
176,0,0.00,5.00,5.00,5.00
208,0,0.00,5.00,5.00,5.00
240,0,0.00,5.00,5.00,5.00
272,1,0.00,5.00,5.00,5.00
304,1,0.00,5.00,5.00,5.00
336,1,0.00,5.00,5.00,5.00
368,1,0.00,5.00,5.00,5.00
400,1,0.00,5.00,5.00,5.00
432,1,0.00,5.00,5.00,5.00
464,1,0.00,5.00,5.00,5.00
496,1,0.00,5.00,5.00,5.00
528,2,0.00,5.00,5.00,5.00
560,2,0.00,5.01,5.00,5.00
592,2,0.00,5.00,5.00,5.00
624,2,0.00,5.00,5.00,5.00
656,2,0.00,5.00,5.00,5.00
688,2,0.00,5.00,5.00,5.00
720,2,0.00,5.00,5.00,5.00
752,2,0.00,5.00,5.00,5.00
784,3,0.00,5.01,5.00,5.00
816,3,0.00,5.00,5.00,5.00
848,3,0.00,5.00,5.00,5.00
880,3,0.00,5.00,5.00,5.00
912,3,0.00,5.00,5.00,5.00
944,3,0.00,5.00,5.00,5.00
976,3,0.00,5.00,5.00,5.00
1008,3,0.00,5.00,5.00,5.00
1040,4,0.00,5.00,5.00,5.00
1296,5,0.00,4.47,4.38,4.37
1552,6,0.00,4.38,4.38,4.37
1808,7,0.00,4.38,4.38,4.37
2064,8,0.00,4.38,4.38,4.37
2320,9,0.00,4.38,4.38,4.38
2576,10,0.00,4.38,4.38,4.38
2832,11,0.00,4.38,4.38,4.38
3088,12,0.00,4.38,4.38,4.38
3344,13,0.00,4.38,4.38,4.38
3600,14,0.00,4.38,4.38,4.38
3856,15,0.00,4.38,4.38,4.38
4112,16,0.00,4.38,4.38,4.38
4368,17,0.00,4.38,4.38,4.38
4624,18,0.00,4.38,4.38,4.38
4880,19,0.00,4.38,4.38,4.38
5136,20,0.00,4.38,4.38,4.38
5392,21,0.00,4.38,4.38,4.38
5648,22,0.00,4.38,4.38,4.38
5904,23,0.00,4.38,4.38,4.38
6160,24,0.00,4.38,4.38,4.38
6416,25,0.00,4.38,4.38,4.38
6672,26,0.00,4.38,4.38,4.38
6928,27,0.00,4.38,4.38,4.38
7184,28,0.00,4.38,4.38,4.38
7440,29,0.00,4.38,4.38,4.38
7696,30,0.00,4.38,4.38,4.38
7952,31,0.00,4.38,4.38,4.38
8208,32,0.00,4.38,4.38,4.39
10256,40,0.00,4.38,4.38,5.54
12304,48,0.00,4.38,4.38,6.25
14352,56,0.00,4.38,4.38,6.71
16400,64,0.00,4.38,4.38,7.09
18448,72,0.00,4.38,4.38,7.39
20496,80,0.00,4.39,4.38,7.64
22544,88,0.00,4.38,4.39,7.78
24592,96,0.00,4.38,4.38,7.99
26640,104,0.00,4.38,4.38,8.11
28688,112,0.00,4.38,4.38,8.24
30736,120,0.00,4.38,4.39,8.31
32784,128,0.00,4.38,4.38,8.40
34832,136,0.00,4.38,4.39,8.48
36880,144,0.00,4.38,4.39,8.52
38928,152,0.00,4.39,4.38,8.61
40976,160,0.00,4.39,4.39,8.68
43024,168,0.00,4.39,4.39,8.72
45072,176,0.00,4.39,4.39,8.75
47120,184,0.00,4.39,4.39,8.79
49168,192,0.00,4.39,4.39,8.84
51216,200,0.00,4.40,4.39,9.65
53264,208,0.00,4.40,4.40,10.27
55312,216,0.00,4.40,4.40,10.28
57360,224,0.00,4.40,4.40,10.24
59408,232,0.00,4.40,4.40,10.87
61456,240,0.00,4.40,4.75,13.37
63504,248,0.00,5.03,4.41,12.44
65552,256,0.00,4.41,4.41,12.42
81936,320,0.00,4.42,4.42,18.38
98320,384,0.00,4.42,4.42,23.70
114704,448,0.00,4.43,4.43,26.76
131088,512,0.00,4.43,4.43,29.56
147472,576,0.00,4.43,4.43,31.62
163856,640,0.00,4.43,4.43,33.42
180240,704,0.00,4.43,4.43,34.78
196624,768,0.00,4.43,4.43,36.03
213008,832,0.00,4.43,4.43,36.97
229392,896,0.00,4.43,4.43,37.86
245776,960,0.00,4.43,4.43,38.49
262160,1024,1.00,4.43,4.43,39.09
278544,1088,1.06,4.43,4.43,39.68
294928,1152,1.12,4.43,4.43,40.15
311312,1216,1.19,5.05,5.05,40.62
327696,1280,1.25,4.43,4.43,41.04
344080,1344,1.31,5.05,5.05,41.38
360464,1408,1.38,4.43,4.43,41.69
376848,1472,1.44,4.43,4.43,42.03
393232,1536,1.50,4.43,4.43,42.27
409616,1600,1.56,4.43,4.43,42.55
426000,1664,1.62,4.43,4.43,42.77
442384,1728,1.69,4.43,4.43,42.96
458768,1792,1.75,4.43,4.43,43.16
475152,1856,1.81,4.43,4.43,43.37
491536,1920,1.88,4.43,4.43,43.53
507920,1984,1.94,4.43,4.43,43.68
524304,2048,2.00,4.43,4.43,43.85
655376,2560,2.50,4.44,4.44,46.89
786448,3072,3.00,4.44,4.44,48.73
917520,3584,3.50,4.44,4.44,50.00
1048592,4096,4.00,4.44,4.44,51.03
1179664,4608,4.50,4.44,4.44,51.90
1310736,5120,5.00,4.43,4.44,52.57
1441808,5632,5.50,4.44,4.44,53.16
1572880,6144,6.00,4.44,4.44,53.72
1703952,6656,6.50,4.44,4.44,54.42
1835024,7168,7.00,4.44,4.44,55.17
1966096,7680,7.50,4.44,4.44,56.13
2097168,8192,8.00,4.45,4.45,57.30
2228240,8704,8.50,4.46,4.46,58.58
2359312,9216,9.00,4.46,4.46,60.02
2490384,9728,9.50,4.47,4.47,61.72
2621456,10240,10.00,4.48,4.48,63.03
2752528,10752,10.50,4.50,4.50,66.01
2883600,11264,11.00,4.51,4.51,69.14
3014672,11776,11.50,4.52,4.52,71.43
3145744,12288,12.00,4.53,4.53,75.51
3276816,12800,12.50,4.54,4.54,78.59
3407888,13312,13.00,4.55,4.55,82.20
3538960,13824,13.50,4.56,4.56,85.67
3670032,14336,14.00,4.57,4.57,89.48
3801104,14848,14.50,4.58,4.58,93.32
3932176,15360,15.00,4.58,4.59,96.87
4063248,15872,15.50,4.59,4.59,100.72
4194320,16384,16.00,4.59,4.59,103.49
4718608,18432,18.00,4.60,4.61,115.77
5242896,20480,20.00,4.61,4.61,126.94
5767184,22528,22.00,4.62,4.62,134.91
6291472,24576,24.00,4.62,4.62,141.79
6815760,26624,26.00,4.62,4.62,148.49
7340048,28672,28.00,4.62,4.62,153.88
7864336,30720,30.00,4.62,4.63,158.49
8388624,32768,32.00,4.62,4.63,162.51
8912912,34816,34.00,4.62,4.63,166.56
9437200,36864,36.00,4.62,4.63,169.80
9961488,38912,38.00,4.62,4.63,172.76
10485776,40960,40.00,4.62,4.63,175.96
11010064,43008,42.00,4.61,4.62,177.17
11534352,45056,44.00,4.61,4.62,179.11
12058640,47104,46.00,4.62,4.62,181.29
12582928,49152,48.00,4.61,4.62,182.99"""

lines = data.strip().split('\n')
size_kb = []
forward = []
backward = []
random_times = []

for line in lines[1:]:
    parts = line.split(',')
    size_kb.append(int(parts[1]))  # Size_KB
    forward.append(float(parts[3]))  # Forward
    backward.append(float(parts[4]))  # Backward
    random_times.append(float(parts[5]))  # Random

plt.figure(figsize=(14, 8))

plt.plot(size_kb, forward, 'b-', label='Прямой обход', linewidth=2.5, alpha=0.8)
plt.plot(size_kb, backward, 'g-', label='Обратный обход', linewidth=2.5, alpha=0.8)
plt.plot(size_kb, random_times, 'r-', label='Случайный обход', linewidth=2.5, alpha=0.8)

plt.xlabel('Размер массива (KB)', fontsize=12, fontweight='bold')
plt.ylabel('Время доступа (такты процессора)', fontsize=12, fontweight='bold')
plt.title('Влияние кэш-памяти на время обработки массивов',
          fontsize=14, fontweight='bold', pad=20)

plt.axvline(x=32, color='orange', linestyle='--', alpha=0.7, linewidth=2)
plt.text(35, 170, 'L1 кэш\n32 KB', ha='left', va='bottom', fontsize=10,
         bbox=dict(boxstyle="round,pad=0.3", facecolor='yellow', alpha=0.7))

plt.axvline(x=256, color='purple', linestyle='--', alpha=0.7, linewidth=2)
plt.text(260, 170, 'L2 кэш\n256 KB', ha='left', va='bottom', fontsize=10,
         bbox=dict(boxstyle="round,pad=0.3", facecolor='violet', alpha=0.7))

plt.axvline(x=8192, color='red', linestyle='--', alpha=0.7, linewidth=2)
plt.text(8300, 170, 'L3 кэш\n8 MB', ha='left', va='bottom', fontsize=10,
         bbox=dict(boxstyle="round,pad=0.3", facecolor='pink', alpha=0.7))

plt.legend(fontsize=11, loc='upper left')
plt.grid(True, alpha=0.3, linestyle='-')

plt.xscale('log')

x_ticks = [16, 32, 64, 128, 256, 512, 1024, 2048, 4096, 8192, 16384, 32768, 49152]
x_labels = ['16KB', '32KB', '64KB', '128KB', '256KB', '512KB', '1MB', '2MB', '4MB', '8MB', '16MB', '32MB', '48MB']
plt.xticks(x_ticks, x_labels)

plt.ylim(0, 200)
plt.xlim(10, 50000) 

slowdown = random_times[-1] / forward[-1]
plt.annotate(f'Замедление: {slowdown:.1f}×',
             xy=(0.05, 0.95), xycoords='axes fraction',
             fontsize=12, fontweight='bold',
             bbox=dict(boxstyle="round,pad=0.3", facecolor='white', alpha=0.8))

plt.tight_layout()
plt.savefig('cache.png', dpi=300, bbox_inches='tight')
plt.show()
